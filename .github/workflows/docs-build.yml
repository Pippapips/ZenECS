name: Build API Documentation

on:
  push:
    branches:
      - main
      - develop
    paths:
      - 'src/**'
      - 'Packages/com.zenecs.core/Runtime/**'
      - 'Packages/com.zenecs.adapter.unity/Runtime/**'
      - 'Packages/com.zenecs.adapter.unity/Editor/**'
      - 'Docs_/**'
  pull_request:
    branches:
      - main
      - develop
    paths:
      - 'src/**'
      - 'Packages/com.zenecs.core/Runtime/**'
      - 'Packages/com.zenecs.adapter.unity/Runtime/**'
      - 'Packages/com.zenecs.adapter.unity/Editor/**'
      - 'Docs_/**'
  workflow_dispatch:

jobs:
  build-docs:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'
      
      - name: Install DocFX
        run: dotnet tool install -g docfx
      
      - name: Add DocFX to PATH
        run: echo "$HOME/.dotnet/tools" >> $GITHUB_PATH
      
      - name: Build ZenECS.Core
        run: |
          cd src
          dotnet build ZenECS.Core.csproj -c Release /p:GenerateDocumentationFile=true
      
      - name: Build ZenECS.Adapter.Unity
        run: |
          cd src
          dotnet build ZenECS.Adapter.Unity.csproj -c Release /p:GenerateDocumentationFile=true
      
      - name: Build DocFX documentation
        run: |
          cd Docs_
          docfx docfx.json
      
      - name: Upload documentation artifacts
        uses: actions/upload-artifact@v4
        with:
          name: api-documentation
          path: Docs_/_site
          retention-days: 30
      
      - name: Check for documentation errors
        run: |
          if [ ! -d "Docs_/_site" ]; then
            echo "Documentation build failed - _site directory not found"
            exit 1
          fi
          if [ ! -f "Docs_/_site/index.html" ]; then
            echo "Documentation build failed - index.html not found"
            exit 1
          fi
          echo "Documentation built successfully"

